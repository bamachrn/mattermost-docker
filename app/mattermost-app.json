{  
  "kind":"Template",
  "apiVersion":"v1",
  "metadata":{  
    "name":"mattermost-app",
    "creationTimestamp":null,
    "annotations":{  
      "description":"Mattermost"
    }
  },
  "parameters":[  
    {  
      "name":"PG_SERVICE",
      "description":"postgresql database name"
    }
  ],
  "objects":[  
    {  
      "kind":"DeploymentConfig",
      "apiVersion":"v1",
      "metadata":{  
        "name":"mattermost-app",
        "creationTimestamp":null
      },
      "spec":{  
        "strategy":{  
          "type":"Recreate",
          "resources":{  

          }
        },
        "triggers":[  
          {  
            "type":"ConfigChange"
          }
        ],
        "replicas":1,
        "selector":{  
          "name":"mattermost"
        },
        "template":{  
          "metadata":{  
            "creationTimestamp":null,
            "labels":{  
              "name":"mattermost"
            }
          },
          "spec":{  
            "containers":[  
              {  
                "name":"mattermost-app",
                "image":"syamgk/mattermost-app:latest",
                "ports":[  
                  {  
                    "containerPort":8080,
                    "protocol":"TCP"
                  }
                ],
                "env":[  
                  {  
                    "name":"DB_HOST",
                    "value":"${PG_SERVICE}"
                  },
                  {  
                    "name":"DB_PORT_5432_TCP_PORT",
                    "value":"5432"
                  },
                  {  
                    "name":"MM_USERNAME",
                    "value":"${PG_USERNAME}"
                  },
                  {  
                    "name":"MM_PASSWORD",
                    "value":"${PG_PASSWORD}"
                  },
                  {  
                    "name":"MM_DBNAME",
                    "value":"${PG_DBNAME}"
                  }
                ],
                "resources":{  

                },
                "terminationMessagePath":"/dev/termination-log",
                "securityContext":{  
                  "privileged":false
                }
              }
            ],
            "restartPolicy":"Always",
            "dnsPolicy":"ClusterFirst"
          }
        }
      }
    },
    {  
      "kind":"Service",
      "apiVersion":"v1",
      "metadata":{  
        "name":"mattermost",
        "labels":{  
          "name":"mattermost"
        }
      },
      "spec":{  
        "ports":[  
          {  
            "protocol":"TCP",
            "port":8080,
            "targetPort":8080,
            "nodePort":0
          }
        ],
        "selector":{  
          "name":"mattermost"
        },
        "type":"ClusterIP",
        "sessionAffinity":"None"
      }
    }
  ]
}
